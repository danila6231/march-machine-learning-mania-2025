<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>cs 670 report</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="cs 670 report_files/libs/clipboard/clipboard.min.js"></script>
<script src="cs 670 report_files/libs/quarto-html/quarto.js"></script>
<script src="cs 670 report_files/libs/quarto-html/popper.min.js"></script>
<script src="cs 670 report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="cs 670 report_files/libs/quarto-html/anchor.min.js"></script>
<link href="cs 670 report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="cs 670 report_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="cs 670 report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="cs 670 report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="cs 670 report_files/libs/bootstrap/bootstrap-c0367b04c37547644fece4185067e4a7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">cs 670 report</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1><strong>Introduction</strong></h1>
<p>March Madness, the NCAA Men’s Basketball Tournament, is one of the most unpredictable and highly anticipated sporting events in the United States. Every year, millions of fans attempt to fill out the perfect bracket, yet the tournament’s single-elimination format and frequent upsets make accurate predictions incredibly challenging. As data analytics and machine learning continue to evolve, researchers and enthusiasts alike are exploring ways to use data-driven approaches to gain a competitive edge in predicting game outcomes.</p>
<p>This report explores the methodologies, datasets, and statistical models used in the analysis and prediction of March Madness 2025 game outcomes. It highlights key performance indicators (KPIs), such as team efficiency metrics, player statistics, seed histories. The goal is to assess the predictive power of various data sources and models, and to identify patterns or strategies that may enhance the accuracy of future predictions. By using historical data and current season metrics, this research could contribute to the growing field of sports analytics and offer insights into the ever-evolving art and science of bracket forecasting.</p>
</section>
<section id="data-setup" class="level1">
<h1>Data Setup</h1>
<p>First lets import the required packages.</p>
<div id="6d7b5d62" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> brier_score_loss, mean_squared_error, accuracy_score</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, OneHotEncoder</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_validate, TimeSeriesSplit</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> RandomizedSearchCV</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>sns.set_theme(font_scale<span class="op">=</span><span class="fl">1.3</span>, palette<span class="op">=</span><span class="st">'Set2'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="64e897f4" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!pip install kaggle</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#!kaggle competitions download -c march-machine-learning-mania-2025</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>zip_file_path <span class="op">=</span> <span class="st">'march-machine-learning-mania-2025.zip'</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>extract_dir <span class="op">=</span> <span class="st">'./data'</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> zipfile.ZipFile(zip_file_path, <span class="st">'r'</span>) <span class="im">as</span> zip_ref:</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    zip_ref.extractall(extract_dir)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="goal" class="level1">
<h1>Goal</h1>
<p>The primary objective of this research is to <strong>predict the win probability</strong> for every possible matchup in the season using data-driven methods.</p>
<section id="key-aspects" class="level2">
<h2 class="anchored" data-anchor-id="key-aspects">Key Aspects</h2>
<ul>
<li><strong>Prediction Metric:</strong>
<ul>
<li>The <strong>Brier score</strong> will be used to evaluate the accuracy of predictions.<br>
</li>
<li>Formula: <strong>Brier score = (Actual result - Forecast Probability)²</strong></li>
</ul></li>
</ul>
</section>
<section id="data-driven-questions" class="level2">
<h2 class="anchored" data-anchor-id="data-driven-questions">Data-Driven Questions</h2>
<ul>
<li><strong>Differences in Men’s vs.&nbsp;Women’s Data:</strong>
<ul>
<li>Are there any notable statistical differences between the two datasets?</li>
</ul></li>
<li><strong>Coach Impact:</strong>
<ul>
<li>Does the coach’s experience and strategy significantly influence game outcomes?</li>
</ul></li>
<li><strong>Key Predictive Features:</strong>
<ul>
<li>What variables (e.g., team ranking, past performance, location) contribute most to accurate predictions?</li>
</ul></li>
</ul>
<p>This research aims to refine sports analytics models, identify key factors influencing game outcomes, and improve the accuracy of March Madness predictions.</p>
</section>
<section id="brier-score" class="level2">
<h2 class="anchored" data-anchor-id="brier-score">Brier Score</h2>
<section id="definition" class="level3">
<h3 class="anchored" data-anchor-id="definition">Definition</h3>
<p>The <strong>Brier Score (BS)</strong> is a metric used to measure the accuracy of probabilistic predictions. It quantifies the mean squared error between the predicted probability of an event occurring and the actual outcome.</p>
</section>
<section id="formula" class="level3">
<h3 class="anchored" data-anchor-id="formula">Formula:</h3>
<p><span class="math display">\[
BS = \frac{1}{N} \sum_{t=1}^{N} (f_t - o_t)^2
\]</span> Where:<br>
- ( N ) = Number of predictions<br>
- ( f_t ) = Forecasted probability of the event occurring<br>
- ( o_t ) = Actual outcome (1 if the event occurs, 0 if it does not)</p>
</section>
<section id="interpreting-the-score" class="level3">
<h3 class="anchored" data-anchor-id="interpreting-the-score">Interpreting the Score</h3>
<ul>
<li>The Brier Score ranges from <strong>0 to 1</strong>, where <strong>lower values indicate better predictive performance</strong>.</li>
<li>A <strong>perfect prediction</strong> results in a <strong>Brier Score of 0</strong>.</li>
<li>A <strong>completely incorrect prediction</strong> results in a <strong>Brier Score of 1</strong>.</li>
<li>A <strong>random guess (e.g., 50% probability for both outcomes)</strong> tends to yield a <strong>higher Brier Score</strong>, reflecting greater uncertainty.</li>
</ul>
</section>
<section id="example-calculations" class="level3">
<h3 class="anchored" data-anchor-id="example-calculations">Example Calculations</h3>
<p>The table below illustrates how Brier Scores are computed for different matchups and prediction probabilities:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 38%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Game</strong></th>
<th><strong>Result</strong></th>
<th><strong>Predicted Team 1 Win Probability</strong></th>
<th><strong>Brier Score</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Team 1 wins</td>
<td>0.5</td>
<td><strong>0.25</strong></td>
</tr>
<tr class="even">
<td>2</td>
<td>Team 2 wins</td>
<td>0.5</td>
<td><strong>0.25</strong></td>
</tr>
<tr class="odd">
<td>1</td>
<td>Team 1 wins</td>
<td>0.6</td>
<td><strong>0.16</strong></td>
</tr>
<tr class="even">
<td>2</td>
<td>Team 2 wins</td>
<td>0.4</td>
<td><strong>0.16</strong></td>
</tr>
<tr class="odd">
<td>1</td>
<td>Team 1 wins</td>
<td>1.0</td>
<td><strong>0.00</strong></td>
</tr>
<tr class="even">
<td>2</td>
<td>Team 2 wins</td>
<td>0.0</td>
<td><strong>0.00</strong></td>
</tr>
</tbody>
</table>
</section>
<section id="key-observations" class="level3">
<h3 class="anchored" data-anchor-id="key-observations">Key Observations</h3>
<ul>
<li><strong>A 50% probability (0.5) always results in a 0.25 Brier Score</strong> if the actual outcome is 1 or 0.</li>
<li><strong>Predictions closer to 1 or 0 improve accuracy</strong> (e.g., a prediction of 1 for a winning team leads to a score of 0).</li>
<li><strong>Lower scores indicate better forecasting accuracy</strong> and reflect well-calibrated models.</li>
</ul>
</section>
<section id="use-in-march-madness-predictions" class="level3">
<h3 class="anchored" data-anchor-id="use-in-march-madness-predictions">Use in March Madness Predictions</h3>
<p>The Brier Score is particularly useful for evaluating models predicting <strong>game outcomes</strong> in March Madness:</p>
<p>- It helps assess how <strong>reliable and calibrated</strong> a model is in assigning probabilities.</p>
<p>- Comparing Brier Scores across different models allows researchers to determine the <strong>best approach for tournament predictions</strong>.</p>
<p>By minimizing the <strong>Brier Score</strong>, analysts can improve the precision of their March Madness forecasts and refine predictive strategies based on historical and real-time data.</p>
</section>
</section>
</section>
<section id="data-exploration" class="level1">
<h1>Data Exploration</h1>
<p>To develop an effective predictive model for March Madness 2025, various historical and real-time data sources are used. These datasets provide crucial insights into team performance, tournament trends, and external factors influencing game outcomes.</p>
<section id="key-data-categories" class="level2">
<h2 class="anchored" data-anchor-id="key-data-categories">Key Data Categories</h2>
<ul>
<li><strong>Team Seeds</strong>
<ul>
<li>Official NCAA tournament seedings assigned to teams each year.</li>
<li>Higher seeds generally indicate stronger teams but are not always predictive of outcomes.</li>
</ul></li>
<li><strong>Public Rankings</strong>
<ul>
<li>Team rankings from various sources such as the AP Poll, Coaches Poll, and advanced analytics models.</li>
<li>Helps assess how teams are perceived before and during the tournament.</li>
</ul></li>
<li><strong>Game Locations (City, State)</strong>
<ul>
<li>Information on where each game is played, including the city and state.</li>
<li>Certain teams may have a home-court advantage or perform better/worse in specific locations.</li>
</ul></li>
<li><strong>Coach Data</strong>
<ul>
<li>Historical performance of coaches in the regular season and tournament play.</li>
<li>Coaching strategies, experience, and records in close games and upsets.</li>
</ul></li>
<li><strong>Regular Season Game Outcomes and Scores</strong>
<ul>
<li>Win/loss records, final scores, and point differentials from the season.</li>
<li>Evaluating how teams perform against different types of opponents.</li>
</ul></li>
<li><strong>Team Conferences</strong>
<ul>
<li>The conference each team belongs to (e.g., Big Ten, SEC, ACC).</li>
<li>Certain conferences historically perform better in the tournament than others.</li>
</ul></li>
<li><strong>History of NCAA Tournament Games and Scores</strong>
<ul>
<li><strong>Men’s tournament history since 1985</strong>
<ul>
<li>Data on all past games, including upsets, seed performance, and championship outcomes.</li>
</ul></li>
<li><strong>Women’s tournament history since 1998</strong>
<ul>
<li>Similar data on historical trends in the women’s tournament.</li>
</ul></li>
</ul></li>
</ul>
<div id="db7e2f07" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import team data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>w_team <span class="op">=</span> pd.read_csv(<span class="st">'data/WTeams.csv'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>m_team <span class="op">=</span> pd.read_csv(<span class="st">'data/MTeams.csv'</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>w_team.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TeamID</th>
<th data-quarto-table-cell-role="th">TeamName</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>3101</td>
<td>Abilene Chr</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>3102</td>
<td>Air Force</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3103</td>
<td>Akron</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3104</td>
<td>Alabama</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>3105</td>
<td>Alabama A&amp;M</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="591e34a2" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Regular season results</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>m_tourney_results <span class="op">=</span> pd.read_csv(<span class="st">'data/MNCAATourneyCompactResults.csv'</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>w_tourney_results <span class="op">=</span> pd.read_csv(<span class="st">'data/WNCAATourneyCompactResults.csv'</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>m_tourney_results.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Season</th>
<th data-quarto-table-cell-role="th">DayNum</th>
<th data-quarto-table-cell-role="th">WTeamID</th>
<th data-quarto-table-cell-role="th">WScore</th>
<th data-quarto-table-cell-role="th">LTeamID</th>
<th data-quarto-table-cell-role="th">LScore</th>
<th data-quarto-table-cell-role="th">WLoc</th>
<th data-quarto-table-cell-role="th">NumOT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1985</td>
<td>136</td>
<td>1116</td>
<td>63</td>
<td>1234</td>
<td>54</td>
<td>N</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1985</td>
<td>136</td>
<td>1120</td>
<td>59</td>
<td>1345</td>
<td>58</td>
<td>N</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1985</td>
<td>136</td>
<td>1207</td>
<td>68</td>
<td>1250</td>
<td>43</td>
<td>N</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1985</td>
<td>136</td>
<td>1229</td>
<td>58</td>
<td>1425</td>
<td>55</td>
<td>N</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1985</td>
<td>136</td>
<td>1242</td>
<td>49</td>
<td>1325</td>
<td>38</td>
<td>N</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Lets explore score differences between men’s and women’s data.</p>
<div id="a3a59259" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by season and calculate the average scores for men's tournament</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>avg_scores_men <span class="op">=</span> m_tourney_results.groupby(<span class="st">'Season'</span>)[[<span class="st">'WScore'</span>, <span class="st">'LScore'</span>]].mean()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by season and calculate the average scores for women's tournament</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>avg_scores_women <span class="op">=</span> w_tourney_results.groupby(<span class="st">'Season'</span>)[[<span class="st">'WScore'</span>, <span class="st">'LScore'</span>]].mean()</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the delta between winning and losing scores for both men's and women's tournaments</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>avg_scores_men[<span class="st">'Delta'</span>] <span class="op">=</span> avg_scores_men[<span class="st">'WScore'</span>] <span class="op">-</span> avg_scores_men[<span class="st">'LScore'</span>]</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>avg_scores_women[<span class="st">'Delta'</span>] <span class="op">=</span> avg_scores_women[<span class="st">'WScore'</span>] <span class="op">-</span> avg_scores_women[<span class="st">'LScore'</span>]</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the delta scores for both men's and women's tournaments</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>plt.plot(avg_scores_men.index, avg_scores_men[<span class="st">'Delta'</span>], marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'b'</span>, label<span class="op">=</span><span class="st">'Men Score Delta'</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>plt.plot(avg_scores_women.index, avg_scores_women[<span class="st">'Delta'</span>], marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'r'</span>, label<span class="op">=</span><span class="st">'Women Score Delta'</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Delta Between Winning and Losing Scores Throughout the Years (Men vs Women)'</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Season'</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Score Delta'</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cs%20670%20report_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>On this graph we can see that if women win they tend to win by a larger margin than men. This could be explained by a higher difference in class between women’s stronger and weaker teams.<br>
</p>
</section>
<section id="team-specific-feature-engineering" class="level2">
<h2 class="anchored" data-anchor-id="team-specific-feature-engineering">Team-specific feature engineering</h2>
<p>First, lets focus on exploring the team-specific features.</p>
<p>These features capture key team performance metrics and coaching factors that may influence game outcomes.</p>
<section id="key-features" class="level3">
<h3 class="anchored" data-anchor-id="key-features">Key Features</h3>
<ul>
<li><strong>Average Points Delta</strong>
<ul>
<li>Difference between points scored by the team and points allowed by opponents during the regular season.</li>
<li>Helps assess team dominance in scoring.</li>
</ul></li>
<li><strong>Win Rate During Regular Season</strong>
<ul>
<li>Percentage of games won by the team before the tournament.</li>
<li>A strong predictor of overall team strength.</li>
</ul></li>
<li><strong>Coach Fired During the Season (Flag)</strong>
<ul>
<li>Indicates whether the head coach was fired mid-season.</li>
<li>Sudden coaching changes can disrupt team performance.</li>
</ul></li>
<li><strong>Coach Consecutive Years with Team</strong>
<ul>
<li>Number of consecutive seasons the coach has been leading the team.</li>
<li>Long-tenured coaches may have more stable and successful programs.</li>
</ul></li>
<li><strong>Men’s or Women’s NCAA Division</strong>
<ul>
<li>Differentiates between the men’s and women’s tournaments.</li>
<li>Important for understanding historical trends and performance differences.</li>
</ul></li>
</ul>
<p>These features enhance predictive models by incorporating both <strong>team performance statistics</strong> and <strong>coaching stability factors</strong>, which may impact March Madness outcomes.</p>
<p>Import team data:</p>
<div id="f550df60" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>m_teams <span class="op">=</span> pd.read_csv(<span class="st">'data/MTeams.csv'</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>w_teams <span class="op">=</span> pd.read_csv(<span class="st">'data/WTeams.csv'</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>m_teams[<span class="st">'gender'</span>] <span class="op">=</span> <span class="st">'M'</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>w_teams[<span class="st">'gender'</span>] <span class="op">=</span> <span class="st">'W'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now lets create a separate record for each season of each team</p>
<div id="876d7e4a" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a separate record for each year for women teams since 1998</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>w_teams_expanded <span class="op">=</span> w_teams.loc[w_teams.index.repeat(<span class="dv">2025</span> <span class="op">-</span> <span class="dv">1998</span> <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>w_teams_expanded[<span class="st">'Season'</span>] <span class="op">=</span> w_teams.<span class="bu">apply</span>(<span class="kw">lambda</span> row: <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1998</span>, <span class="dv">2025</span> <span class="op">+</span> <span class="dv">1</span>)), axis<span class="op">=</span><span class="dv">1</span>).explode().values</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a separate record for each year for men teams for every season the team is in D1</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>m_teams_expanded <span class="op">=</span> m_teams.loc[m_teams.index.repeat(m_teams[<span class="st">'LastD1Season'</span>] <span class="op">-</span> m_teams[<span class="st">'FirstD1Season'</span>] <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>m_teams_expanded[<span class="st">'Season'</span>] <span class="op">=</span> m_teams.<span class="bu">apply</span>(<span class="kw">lambda</span> row: <span class="bu">list</span>(<span class="bu">range</span>(row[<span class="st">'FirstD1Season'</span>], row[<span class="st">'LastD1Season'</span>] <span class="op">+</span> <span class="dv">1</span>)), axis<span class="op">=</span><span class="dv">1</span>).explode().values</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the expanded dataframes</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>teams_expanded <span class="op">=</span> pd.concat([m_teams_expanded, w_teams_expanded], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>teams_expanded.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="37">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TeamID</th>
<th data-quarto-table-cell-role="th">TeamName</th>
<th data-quarto-table-cell-role="th">FirstD1Season</th>
<th data-quarto-table-cell-role="th">LastD1Season</th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">Season</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1101</td>
<td>Abilene Chr</td>
<td>2014.0</td>
<td>2025.0</td>
<td>M</td>
<td>2014</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>1101</td>
<td>Abilene Chr</td>
<td>2014.0</td>
<td>2025.0</td>
<td>M</td>
<td>2015</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1101</td>
<td>Abilene Chr</td>
<td>2014.0</td>
<td>2025.0</td>
<td>M</td>
<td>2016</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>1101</td>
<td>Abilene Chr</td>
<td>2014.0</td>
<td>2025.0</td>
<td>M</td>
<td>2017</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1101</td>
<td>Abilene Chr</td>
<td>2014.0</td>
<td>2025.0</td>
<td>M</td>
<td>2018</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Adding the seed data to teams:</p>
<div id="353772ed" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>m_seed <span class="op">=</span> pd.read_csv(<span class="st">'data/MNCAATourneySeeds.csv'</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>w_seed <span class="op">=</span> pd.read_csv(<span class="st">'data/WNCAATourneySeeds.csv'</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>seed_df <span class="op">=</span> pd.concat([m_seed, w_seed], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>seed_df[<span class="st">'Region'</span>] <span class="op">=</span> seed_df[<span class="st">'Seed'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x[<span class="dv">0</span>])</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>seed_df[<span class="st">'Seed_num'</span>] <span class="op">=</span> seed_df[<span class="st">'Seed'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">int</span>(x[<span class="dv">1</span>:<span class="dv">3</span>]))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge seed with teams dataframe</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>teams_expanded <span class="op">=</span> pd.merge(seed_df, teams_expanded, on<span class="op">=</span>(<span class="st">'TeamID'</span>, <span class="st">'Season'</span>), how<span class="op">=</span><span class="st">'inner'</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>teams_expanded.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Season</th>
<th data-quarto-table-cell-role="th">Seed</th>
<th data-quarto-table-cell-role="th">TeamID</th>
<th data-quarto-table-cell-role="th">Region</th>
<th data-quarto-table-cell-role="th">Seed_num</th>
<th data-quarto-table-cell-role="th">TeamName</th>
<th data-quarto-table-cell-role="th">FirstD1Season</th>
<th data-quarto-table-cell-role="th">LastD1Season</th>
<th data-quarto-table-cell-role="th">gender</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1985</td>
<td>W01</td>
<td>1207</td>
<td>W</td>
<td>1</td>
<td>Georgetown</td>
<td>1985.0</td>
<td>2025.0</td>
<td>M</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1985</td>
<td>W02</td>
<td>1210</td>
<td>W</td>
<td>2</td>
<td>Georgia Tech</td>
<td>1985.0</td>
<td>2025.0</td>
<td>M</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1985</td>
<td>W03</td>
<td>1228</td>
<td>W</td>
<td>3</td>
<td>Illinois</td>
<td>1985.0</td>
<td>2025.0</td>
<td>M</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1985</td>
<td>W04</td>
<td>1260</td>
<td>W</td>
<td>4</td>
<td>Loyola-Chicago</td>
<td>1985.0</td>
<td>2025.0</td>
<td>M</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1985</td>
<td>W05</td>
<td>1374</td>
<td>W</td>
<td>5</td>
<td>SMU</td>
<td>1985.0</td>
<td>2025.0</td>
<td>M</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="add-features-corresponding-to-the-regular-season-performance" class="level3">
<h3 class="anchored" data-anchor-id="add-features-corresponding-to-the-regular-season-performance">Add features corresponding to the regular season performance</h3>
<div id="b4072aa6" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>m_regular_season_results <span class="op">=</span> pd.read_csv(<span class="st">'data/MRegularSeasonCompactResults.csv'</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>w_regular_season_results <span class="op">=</span> pd.read_csv(<span class="st">'data/WRegularSeasonCompactResults.csv'</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>regular_season_results <span class="op">=</span> pd.concat([m_regular_season_results, w_regular_season_results], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate average points difference for each team for each season</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>regular_season_results[<span class="st">'PointsDiff'</span>] <span class="op">=</span> regular_season_results[<span class="st">'WScore'</span>] <span class="op">-</span> regular_season_results[<span class="st">'LScore'</span>]</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>points_diff_win <span class="op">=</span> regular_season_results[[<span class="st">'Season'</span>, <span class="st">'WTeamID'</span>, <span class="st">'PointsDiff'</span>]]</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>points_diff_win.columns <span class="op">=</span> [<span class="st">'Season'</span>, <span class="st">'TeamID'</span>, <span class="st">'PointsDiff'</span>]</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>points_diff_lose <span class="op">=</span> regular_season_results[[<span class="st">'Season'</span>, <span class="st">'LTeamID'</span>, <span class="st">'PointsDiff'</span>]]</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>points_diff_lose[<span class="st">'PointsDiff'</span>] <span class="op">=</span> <span class="op">-</span>points_diff_lose[<span class="st">'PointsDiff'</span>]</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>points_diff_lose.columns <span class="op">=</span> [<span class="st">'Season'</span>, <span class="st">'TeamID'</span>, <span class="st">'PointsDiff'</span>]</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>point_diff_total <span class="op">=</span> pd.concat([points_diff_win, points_diff_lose], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>point_diff_total[<span class="st">'WinFlag'</span>] <span class="op">=</span> (point_diff_total[<span class="st">'PointsDiff'</span>] <span class="op">&gt;</span> <span class="dv">0</span>).astype(<span class="bu">int</span>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>avg_stats <span class="op">=</span> point_diff_total.groupby(by<span class="op">=</span>[<span class="st">'TeamID'</span>, <span class="st">'Season'</span>])[[<span class="st">'PointsDiff'</span>, <span class="st">'WinFlag'</span>]].mean().reset_index()</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>avg_stats.columns <span class="op">=</span> [<span class="st">'TeamID'</span>, <span class="st">'Season'</span>, <span class="st">'AvgPointsDiff'</span>, <span class="st">'WinRate'</span>]</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with teams dataframe</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>teams_expanded_2 <span class="op">=</span> pd.merge(teams_expanded, avg_stats, on<span class="op">=</span>(<span class="st">'TeamID'</span>, <span class="st">'Season'</span>), how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>teams_expanded_2.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/8v/bx_f_4bj0klchryrhdgxty9h0000gn/T/ipykernel_86666/2144808946.py:13: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  points_diff_lose['PointsDiff'] = -points_diff_lose['PointsDiff']</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="39">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Season</th>
<th data-quarto-table-cell-role="th">Seed</th>
<th data-quarto-table-cell-role="th">TeamID</th>
<th data-quarto-table-cell-role="th">Region</th>
<th data-quarto-table-cell-role="th">Seed_num</th>
<th data-quarto-table-cell-role="th">TeamName</th>
<th data-quarto-table-cell-role="th">FirstD1Season</th>
<th data-quarto-table-cell-role="th">LastD1Season</th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">AvgPointsDiff</th>
<th data-quarto-table-cell-role="th">WinRate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1985</td>
<td>W01</td>
<td>1207</td>
<td>W</td>
<td>1</td>
<td>Georgetown</td>
<td>1985.0</td>
<td>2025.0</td>
<td>M</td>
<td>15.666667</td>
<td>0.925926</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1985</td>
<td>W02</td>
<td>1210</td>
<td>W</td>
<td>2</td>
<td>Georgia Tech</td>
<td>1985.0</td>
<td>2025.0</td>
<td>M</td>
<td>9.354839</td>
<td>0.774194</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1985</td>
<td>W03</td>
<td>1228</td>
<td>W</td>
<td>3</td>
<td>Illinois</td>
<td>1985.0</td>
<td>2025.0</td>
<td>M</td>
<td>10.870968</td>
<td>0.741935</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1985</td>
<td>W04</td>
<td>1260</td>
<td>W</td>
<td>4</td>
<td>Loyola-Chicago</td>
<td>1985.0</td>
<td>2025.0</td>
<td>M</td>
<td>6.766667</td>
<td>0.833333</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1985</td>
<td>W05</td>
<td>1374</td>
<td>W</td>
<td>5</td>
<td>SMU</td>
<td>1985.0</td>
<td>2025.0</td>
<td>M</td>
<td>8.666667</td>
<td>0.733333</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let’s explore the relationship between average points difference and win rate of the team.</p>
<div id="4093d0df" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data<span class="op">=</span>teams_expanded_2, x<span class="op">=</span><span class="st">'AvgPointsDiff'</span>, y<span class="op">=</span><span class="st">'WinRate'</span>, s<span class="op">=</span><span class="dv">30</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, label<span class="op">=</span><span class="st">'Teams'</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>sns.regplot(data<span class="op">=</span>teams_expanded_2, x<span class="op">=</span><span class="st">'AvgPointsDiff'</span>, y<span class="op">=</span><span class="st">'WinRate'</span>, scatter<span class="op">=</span><span class="va">False</span>, color<span class="op">=</span><span class="st">'blue'</span>, label<span class="op">=</span><span class="st">'Regression Line'</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>plt.scatter(<span class="dv">0</span>, <span class="fl">0.5</span>, color<span class="op">=</span><span class="st">'red'</span>, s<span class="op">=</span><span class="dv">100</span>, zorder<span class="op">=</span><span class="dv">5</span>, label<span class="op">=</span><span class="st">'Reference Point (0, 0.5)'</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Win Rate vs Average Points Difference'</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Average Points Difference'</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Win Rate'</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="fl">0.3</span>, <span class="fl">1.02</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cs%20670%20report_files/figure-html/cell-11-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The graph demonstrates a linear relationship between these properties.</p>
<p>It also represents an interesting property about the data. You could expect that the line would pass through the reference point because the team with an average 0 pts difference would should have a 0.5 win rate, but graph shows that these types of teams have a greater win rate.</p>
<p>This could be explained by the fact that the data samples presented contain only the teams that actually qualified for the playoffs. And this could imply that they are better then average in terms of win-rate to points difference relationship.</p>
</section>
<section id="add-public-rankings-data-for-mens-basketball" class="level3">
<h3 class="anchored" data-anchor-id="add-public-rankings-data-for-mens-basketball">Add public rankings data for men’s basketball</h3>
<div id="efd58e71" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>m_public_rankings <span class="op">=</span> pd.read_csv(<span class="st">'data/MMasseyOrdinals.csv'</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>latest_rankings <span class="op">=</span> m_public_rankings.sort_values(<span class="st">'RankingDayNum'</span>, ascending<span class="op">=</span><span class="va">True</span>).drop_duplicates([<span class="st">'Season'</span>, <span class="st">'TeamID'</span>], keep<span class="op">=</span><span class="st">'last'</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>latest_rankings <span class="op">=</span> latest_rankings[[<span class="st">'Season'</span>, <span class="st">'TeamID'</span>, <span class="st">'OrdinalRank'</span>, <span class="st">'SystemName'</span>]]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>latest_rankings.columns <span class="op">=</span> [<span class="st">'Season'</span>, <span class="st">'TeamID'</span>, <span class="st">'PublicRank'</span>, <span class="st">'RankingSystem'</span>]</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>teams_expanded_3 <span class="op">=</span> pd.merge(teams_expanded_2, latest_rankings, on<span class="op">=</span>(<span class="st">'Season'</span>, <span class="st">'TeamID'</span>), how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>teams_expanded_3.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Season</th>
<th data-quarto-table-cell-role="th">Seed</th>
<th data-quarto-table-cell-role="th">TeamID</th>
<th data-quarto-table-cell-role="th">Region</th>
<th data-quarto-table-cell-role="th">Seed_num</th>
<th data-quarto-table-cell-role="th">TeamName</th>
<th data-quarto-table-cell-role="th">FirstD1Season</th>
<th data-quarto-table-cell-role="th">LastD1Season</th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">AvgPointsDiff</th>
<th data-quarto-table-cell-role="th">WinRate</th>
<th data-quarto-table-cell-role="th">PublicRank</th>
<th data-quarto-table-cell-role="th">RankingSystem</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1985</td>
<td>W01</td>
<td>1207</td>
<td>W</td>
<td>1</td>
<td>Georgetown</td>
<td>1985.0</td>
<td>2025.0</td>
<td>M</td>
<td>15.666667</td>
<td>0.925926</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1985</td>
<td>W02</td>
<td>1210</td>
<td>W</td>
<td>2</td>
<td>Georgia Tech</td>
<td>1985.0</td>
<td>2025.0</td>
<td>M</td>
<td>9.354839</td>
<td>0.774194</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1985</td>
<td>W03</td>
<td>1228</td>
<td>W</td>
<td>3</td>
<td>Illinois</td>
<td>1985.0</td>
<td>2025.0</td>
<td>M</td>
<td>10.870968</td>
<td>0.741935</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1985</td>
<td>W04</td>
<td>1260</td>
<td>W</td>
<td>4</td>
<td>Loyola-Chicago</td>
<td>1985.0</td>
<td>2025.0</td>
<td>M</td>
<td>6.766667</td>
<td>0.833333</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1985</td>
<td>W05</td>
<td>1374</td>
<td>W</td>
<td>5</td>
<td>SMU</td>
<td>1985.0</td>
<td>2025.0</td>
<td>M</td>
<td>8.666667</td>
<td>0.733333</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="add-conference-data" class="level3">
<h3 class="anchored" data-anchor-id="add-conference-data">Add conference data</h3>
<p>Likely these features won’t be useful for the prediction, but we can add them to the data for future analysis.</p>
<div id="1f8e2f30" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>conference <span class="op">=</span> pd.read_csv(<span class="st">'data/Conferences.csv'</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>m_team_conference <span class="op">=</span> pd.read_csv(<span class="st">'data/MTeamConferences.csv'</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>w_team_conference <span class="op">=</span> pd.read_csv(<span class="st">'data/WTeamConferences.csv'</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>m_team_conference <span class="op">=</span> m_team_conference.merge(conference, on<span class="op">=</span><span class="st">'ConfAbbrev'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>w_team_conference <span class="op">=</span> w_team_conference.merge(conference, on<span class="op">=</span><span class="st">'ConfAbbrev'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>team_conference <span class="op">=</span> pd.concat([m_team_conference, w_team_conference], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>teams_expanded_4 <span class="op">=</span> pd.merge(teams_expanded_3, team_conference, on<span class="op">=</span>(<span class="st">'TeamID'</span>, <span class="st">'Season'</span>), how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>teams_expanded_4.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Season</th>
<th data-quarto-table-cell-role="th">Seed</th>
<th data-quarto-table-cell-role="th">TeamID</th>
<th data-quarto-table-cell-role="th">Region</th>
<th data-quarto-table-cell-role="th">Seed_num</th>
<th data-quarto-table-cell-role="th">TeamName</th>
<th data-quarto-table-cell-role="th">FirstD1Season</th>
<th data-quarto-table-cell-role="th">LastD1Season</th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">AvgPointsDiff</th>
<th data-quarto-table-cell-role="th">WinRate</th>
<th data-quarto-table-cell-role="th">PublicRank</th>
<th data-quarto-table-cell-role="th">RankingSystem</th>
<th data-quarto-table-cell-role="th">ConfAbbrev</th>
<th data-quarto-table-cell-role="th">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1985</td>
<td>W01</td>
<td>1207</td>
<td>W</td>
<td>1</td>
<td>Georgetown</td>
<td>1985.0</td>
<td>2025.0</td>
<td>M</td>
<td>15.666667</td>
<td>0.925926</td>
<td>NaN</td>
<td>NaN</td>
<td>big_east</td>
<td>Big East Conference</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1985</td>
<td>W02</td>
<td>1210</td>
<td>W</td>
<td>2</td>
<td>Georgia Tech</td>
<td>1985.0</td>
<td>2025.0</td>
<td>M</td>
<td>9.354839</td>
<td>0.774194</td>
<td>NaN</td>
<td>NaN</td>
<td>acc</td>
<td>Atlantic Coast Conference</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1985</td>
<td>W03</td>
<td>1228</td>
<td>W</td>
<td>3</td>
<td>Illinois</td>
<td>1985.0</td>
<td>2025.0</td>
<td>M</td>
<td>10.870968</td>
<td>0.741935</td>
<td>NaN</td>
<td>NaN</td>
<td>big_ten</td>
<td>Big Ten Conference</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1985</td>
<td>W04</td>
<td>1260</td>
<td>W</td>
<td>4</td>
<td>Loyola-Chicago</td>
<td>1985.0</td>
<td>2025.0</td>
<td>M</td>
<td>6.766667</td>
<td>0.833333</td>
<td>NaN</td>
<td>NaN</td>
<td>mw_city</td>
<td>Midwestern City Conference</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1985</td>
<td>W05</td>
<td>1374</td>
<td>W</td>
<td>5</td>
<td>SMU</td>
<td>1985.0</td>
<td>2025.0</td>
<td>M</td>
<td>8.666667</td>
<td>0.733333</td>
<td>NaN</td>
<td>NaN</td>
<td>swc</td>
<td>Southwest Conference</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="add-the-coach-feature-for-men" class="level3">
<h3 class="anchored" data-anchor-id="add-the-coach-feature-for-men">Add the coach feature for men</h3>
<div id="d22f25b8" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>coach_df <span class="op">=</span> pd.read_csv(<span class="st">'data/MTeamCoaches.csv'</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a column to indicate if the coach was fired during the season</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>coach_df[<span class="st">'Fired_During_Season'</span>] <span class="op">=</span> (coach_df[<span class="st">'LastDayNum'</span>] <span class="op">!=</span> <span class="dv">154</span>).astype(<span class="bu">int</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the number of consecutive years of the coach at the team</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>coach_df[<span class="st">'ConsecutiveYears'</span>] <span class="op">=</span> coach_df.groupby([<span class="st">'TeamID'</span>, <span class="st">'CoachName'</span>])[<span class="st">'Season'</span>].rank(method<span class="op">=</span><span class="st">'first'</span>).astype(<span class="bu">int</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>coach_df <span class="op">=</span> coach_df.groupby([<span class="st">'TeamID'</span>, <span class="st">'Season'</span>]).agg(</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    Fired_During_Season<span class="op">=</span>(<span class="st">'Fired_During_Season'</span>, <span class="st">'max'</span>),</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    ConsecutiveYears<span class="op">=</span>(<span class="st">'ConsecutiveYears'</span>, <span class="st">'first'</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>teams_expanded_5 <span class="op">=</span> pd.merge(teams_expanded_4, coach_df, on<span class="op">=</span>(<span class="st">'TeamID'</span>, <span class="st">'Season'</span>), how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>teams_expanded_5[<span class="st">'ExperienceLevel'</span>] <span class="op">=</span> teams_expanded_5[<span class="st">'ConsecutiveYears'</span>].<span class="bu">apply</span>(</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: <span class="st">'NEW'</span> <span class="cf">if</span> x <span class="op">&lt;=</span> <span class="dv">2</span> <span class="cf">else</span> <span class="st">'ENOUGH'</span> <span class="cf">if</span> x <span class="op">&lt;=</span> <span class="dv">4</span> <span class="cf">else</span> <span class="st">'EXPERIENCED'</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>teams_expanded_5.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Season</th>
<th data-quarto-table-cell-role="th">Seed</th>
<th data-quarto-table-cell-role="th">TeamID</th>
<th data-quarto-table-cell-role="th">Region</th>
<th data-quarto-table-cell-role="th">Seed_num</th>
<th data-quarto-table-cell-role="th">TeamName</th>
<th data-quarto-table-cell-role="th">FirstD1Season</th>
<th data-quarto-table-cell-role="th">LastD1Season</th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">AvgPointsDiff</th>
<th data-quarto-table-cell-role="th">WinRate</th>
<th data-quarto-table-cell-role="th">PublicRank</th>
<th data-quarto-table-cell-role="th">RankingSystem</th>
<th data-quarto-table-cell-role="th">ConfAbbrev</th>
<th data-quarto-table-cell-role="th">Description</th>
<th data-quarto-table-cell-role="th">Fired_During_Season</th>
<th data-quarto-table-cell-role="th">ConsecutiveYears</th>
<th data-quarto-table-cell-role="th">ExperienceLevel</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1985</td>
<td>W01</td>
<td>1207</td>
<td>W</td>
<td>1</td>
<td>Georgetown</td>
<td>1985.0</td>
<td>2025.0</td>
<td>M</td>
<td>15.666667</td>
<td>0.925926</td>
<td>NaN</td>
<td>NaN</td>
<td>big_east</td>
<td>Big East Conference</td>
<td>0.0</td>
<td>1.0</td>
<td>NEW</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1985</td>
<td>W02</td>
<td>1210</td>
<td>W</td>
<td>2</td>
<td>Georgia Tech</td>
<td>1985.0</td>
<td>2025.0</td>
<td>M</td>
<td>9.354839</td>
<td>0.774194</td>
<td>NaN</td>
<td>NaN</td>
<td>acc</td>
<td>Atlantic Coast Conference</td>
<td>0.0</td>
<td>1.0</td>
<td>NEW</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1985</td>
<td>W03</td>
<td>1228</td>
<td>W</td>
<td>3</td>
<td>Illinois</td>
<td>1985.0</td>
<td>2025.0</td>
<td>M</td>
<td>10.870968</td>
<td>0.741935</td>
<td>NaN</td>
<td>NaN</td>
<td>big_ten</td>
<td>Big Ten Conference</td>
<td>0.0</td>
<td>1.0</td>
<td>NEW</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1985</td>
<td>W04</td>
<td>1260</td>
<td>W</td>
<td>4</td>
<td>Loyola-Chicago</td>
<td>1985.0</td>
<td>2025.0</td>
<td>M</td>
<td>6.766667</td>
<td>0.833333</td>
<td>NaN</td>
<td>NaN</td>
<td>mw_city</td>
<td>Midwestern City Conference</td>
<td>0.0</td>
<td>1.0</td>
<td>NEW</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1985</td>
<td>W05</td>
<td>1374</td>
<td>W</td>
<td>5</td>
<td>SMU</td>
<td>1985.0</td>
<td>2025.0</td>
<td>M</td>
<td>8.666667</td>
<td>0.733333</td>
<td>NaN</td>
<td>NaN</td>
<td>swc</td>
<td>Southwest Conference</td>
<td>0.0</td>
<td>1.0</td>
<td>NEW</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Exploring the relationship between coach Experience Level and WinRate</p>
<div id="c3d6c363" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out rows with NaN values in 'ExperienceLevel' and 'WinRate'</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>filtered_data <span class="op">=</span> teams_expanded_5.dropna(subset<span class="op">=</span>[<span class="st">'ExperienceLevel'</span>, <span class="st">'WinRate'</span>])</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the win rate depending on coach experience</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>sns.boxplot(data<span class="op">=</span>filtered_data, x<span class="op">=</span><span class="st">'ExperienceLevel'</span>, y<span class="op">=</span><span class="st">'WinRate'</span>, hue<span class="op">=</span><span class="st">'ExperienceLevel'</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Win Rate Depending on Coach Experience'</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Coach Experience Level'</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Win Rate'</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cs%20670%20report_files/figure-html/cell-15-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can see that the more experienced coached tend to have a higher win rate.</p>
</section>
</section>
<section id="pairwise-features" class="level2">
<h2 class="anchored" data-anchor-id="pairwise-features">Pairwise features</h2>
<p>These features compare two teams in a given matchup, capturing differences in performance metrics to improve prediction accuracy.</p>
<section id="key-features-1" class="level3">
<h3 class="anchored" data-anchor-id="key-features-1">Key Features</h3>
<ul>
<li><strong>Difference Between Seeds</strong>
<ul>
<li>Measures the gap in tournament seeding between two teams.</li>
<li>Larger differences often indicate stronger favorites.</li>
</ul></li>
<li><strong>Difference Between Public Rankings</strong>
<ul>
<li>Compares rankings from sources such as AP Polls and Coaches Polls.</li>
<li>Helps assess how the teams are perceived in strength before the matchup.</li>
</ul></li>
<li><strong>Difference Between Point Differentials in Regular Season</strong>
<ul>
<li>Compares how much each team outscored or was outscored by opponents on average.</li>
<li>A higher differential suggests a stronger team.</li>
</ul></li>
</ul>
<p>By incorporating these pairwise comparisons, the model can evaluate relative strengths and weaknesses between two competing teams, refining the accuracy of game outcome predictions.</p>
<p>Extracting previous years tourney results:</p>
<div id="474fcc4f" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>m_tourney_results <span class="op">=</span> pd.read_csv(<span class="st">'data/MNCAATourneyCompactResults.csv'</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>w_tourney_results <span class="op">=</span> pd.read_csv(<span class="st">'data/WNCAATourneyCompactResults.csv'</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>tourney_results <span class="op">=</span> pd.concat([m_tourney_results, w_tourney_results], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>tourney_results.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Season</th>
<th data-quarto-table-cell-role="th">DayNum</th>
<th data-quarto-table-cell-role="th">WTeamID</th>
<th data-quarto-table-cell-role="th">WScore</th>
<th data-quarto-table-cell-role="th">LTeamID</th>
<th data-quarto-table-cell-role="th">LScore</th>
<th data-quarto-table-cell-role="th">WLoc</th>
<th data-quarto-table-cell-role="th">NumOT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1985</td>
<td>136</td>
<td>1116</td>
<td>63</td>
<td>1234</td>
<td>54</td>
<td>N</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1985</td>
<td>136</td>
<td>1120</td>
<td>59</td>
<td>1345</td>
<td>58</td>
<td>N</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1985</td>
<td>136</td>
<td>1207</td>
<td>68</td>
<td>1250</td>
<td>43</td>
<td>N</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1985</td>
<td>136</td>
<td>1229</td>
<td>58</td>
<td>1425</td>
<td>55</td>
<td>N</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1985</td>
<td>136</td>
<td>1242</td>
<td>49</td>
<td>1325</td>
<td>38</td>
<td>N</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Extracting city data:</p>
<div id="e58a6310" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>cities <span class="op">=</span> pd.read_csv(<span class="st">'data/Cities.csv'</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>m_game_cities <span class="op">=</span> pd.read_csv(<span class="st">'data/MGameCities.csv'</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>w_game_cities <span class="op">=</span> pd.read_csv(<span class="st">'data/WGameCities.csv'</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>game_cities <span class="op">=</span> pd.concat([m_game_cities, w_game_cities], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>game_cities <span class="op">=</span> game_cities.merge(cities, on<span class="op">=</span><span class="st">'CityID'</span>, how<span class="op">=</span><span class="st">'left'</span>)    </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>tourney_results <span class="op">=</span> tourney_results.merge(game_cities, on<span class="op">=</span>[<span class="st">'Season'</span>, <span class="st">'DayNum'</span>, <span class="st">'WTeamID'</span>, <span class="st">'LTeamID'</span>], how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>tourney_results.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Season</th>
<th data-quarto-table-cell-role="th">DayNum</th>
<th data-quarto-table-cell-role="th">WTeamID</th>
<th data-quarto-table-cell-role="th">WScore</th>
<th data-quarto-table-cell-role="th">LTeamID</th>
<th data-quarto-table-cell-role="th">LScore</th>
<th data-quarto-table-cell-role="th">WLoc</th>
<th data-quarto-table-cell-role="th">NumOT</th>
<th data-quarto-table-cell-role="th">CRType</th>
<th data-quarto-table-cell-role="th">CityID</th>
<th data-quarto-table-cell-role="th">City</th>
<th data-quarto-table-cell-role="th">State</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1985</td>
<td>136</td>
<td>1116</td>
<td>63</td>
<td>1234</td>
<td>54</td>
<td>N</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1985</td>
<td>136</td>
<td>1120</td>
<td>59</td>
<td>1345</td>
<td>58</td>
<td>N</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1985</td>
<td>136</td>
<td>1207</td>
<td>68</td>
<td>1250</td>
<td>43</td>
<td>N</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1985</td>
<td>136</td>
<td>1229</td>
<td>58</td>
<td>1425</td>
<td>55</td>
<td>N</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1985</td>
<td>136</td>
<td>1242</td>
<td>49</td>
<td>1325</td>
<td>38</td>
<td>N</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="29c84642" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>tourney_results.rename(columns<span class="op">=</span>{</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'WTeamID'</span>: <span class="st">'TeamID_1'</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'WScore'</span>: <span class="st">'Score_1'</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'LTeamID'</span>: <span class="st">'TeamID_2'</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'LScore'</span>: <span class="st">'Score_2'</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>}, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now it’s important switch 50% of the records so that the winning team doesn’t always go first.</p>
<div id="cc9a51a9" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly shuffle 50% of the rows</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">42</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> random.sample(<span class="bu">range</span>(<span class="bu">len</span>(tourney_results)), <span class="bu">len</span>(tourney_results) <span class="op">//</span> <span class="dv">2</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>tourney_results.iloc[mask] <span class="op">=</span> tourney_results.iloc[mask].<span class="bu">apply</span>(</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> row: pd.Series({</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Season'</span>: row[<span class="st">'Season'</span>],</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'DayNum'</span>: row[<span class="st">'DayNum'</span>],</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'TeamID_1'</span>: row[<span class="st">'TeamID_2'</span>],</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Score_1'</span>: row[<span class="st">'Score_2'</span>],</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'TeamID_2'</span>: row[<span class="st">'TeamID_1'</span>],</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Score_2'</span>: row[<span class="st">'Score_1'</span>],</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'WLoc'</span>: row[<span class="st">'WLoc'</span>],</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'NumOT'</span>: row[<span class="st">'NumOT'</span>],</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'CRType'</span>: row[<span class="st">'CRType'</span>],</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'CityID'</span>: row[<span class="st">'CityID'</span>],</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'City'</span>: row[<span class="st">'City'</span>],</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'State'</span>: row[<span class="st">'State'</span>]</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    }), axis<span class="op">=</span><span class="dv">1</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Creating a target, marking if the 1st team has won</p>
<div id="875a06b3" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>tourney_results[<span class="st">'target'</span>] <span class="op">=</span> (tourney_results[<span class="st">'Score_1'</span>] <span class="op">&gt;</span> tourney_results[<span class="st">'Score_2'</span>]).astype(<span class="bu">int</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>tourney_results.sample(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Season</th>
<th data-quarto-table-cell-role="th">DayNum</th>
<th data-quarto-table-cell-role="th">TeamID_1</th>
<th data-quarto-table-cell-role="th">Score_1</th>
<th data-quarto-table-cell-role="th">TeamID_2</th>
<th data-quarto-table-cell-role="th">Score_2</th>
<th data-quarto-table-cell-role="th">WLoc</th>
<th data-quarto-table-cell-role="th">NumOT</th>
<th data-quarto-table-cell-role="th">CRType</th>
<th data-quarto-table-cell-role="th">CityID</th>
<th data-quarto-table-cell-role="th">City</th>
<th data-quarto-table-cell-role="th">State</th>
<th data-quarto-table-cell-role="th">target</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">3835</td>
<td>2018</td>
<td>146</td>
<td>3417</td>
<td>73</td>
<td>3280</td>
<td>89</td>
<td>N</td>
<td>0</td>
<td>NCAA</td>
<td>4174.0</td>
<td>Kansas City</td>
<td>MO</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1921</td>
<td>2015</td>
<td>136</td>
<td>1459</td>
<td>53</td>
<td>1116</td>
<td>56</td>
<td>N</td>
<td>0</td>
<td>NCAA</td>
<td>4168.0</td>
<td>Jacksonville</td>
<td>FL</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3738</td>
<td>2017</td>
<td>138</td>
<td>3211</td>
<td>62</td>
<td>3328</td>
<td>75</td>
<td>N</td>
<td>0</td>
<td>NCAA</td>
<td>4313.0</td>
<td>Seattle</td>
<td>WA</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2877</td>
<td>2003</td>
<td>141</td>
<td>3336</td>
<td>77</td>
<td>3376</td>
<td>67</td>
<td>H</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2398</td>
<td>2023</td>
<td>136</td>
<td>1336</td>
<td>76</td>
<td>1401</td>
<td>59</td>
<td>N</td>
<td>0</td>
<td>NCAA</td>
<td>4097.0</td>
<td>Des Moines</td>
<td>IA</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3751</td>
<td>2017</td>
<td>139</td>
<td>3326</td>
<td>82</td>
<td>3246</td>
<td>68</td>
<td>A</td>
<td>0</td>
<td>NCAA</td>
<td>4193.0</td>
<td>Lexington</td>
<td>KY</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">540</td>
<td>1993</td>
<td>138</td>
<td>1314</td>
<td>112</td>
<td>1348</td>
<td>67</td>
<td>N</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">440</td>
<td>1991</td>
<td>154</td>
<td>1181</td>
<td>72</td>
<td>1242</td>
<td>65</td>
<td>N</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1351</td>
<td>2006</td>
<td>137</td>
<td>1246</td>
<td>69</td>
<td>1412</td>
<td>64</td>
<td>N</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2923</td>
<td>2004</td>
<td>139</td>
<td>3336</td>
<td>79</td>
<td>3214</td>
<td>42</td>
<td>N</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Append the team features for each pair:</p>
<div id="d49f852e" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>teams_expanded_5_1 <span class="op">=</span> teams_expanded_5.add_suffix(<span class="st">'_1'</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>teams_expanded_5_1.rename(columns<span class="op">=</span>{<span class="st">'Season_1'</span>: <span class="st">'Season'</span>, <span class="st">'TeamID_1'</span>: <span class="st">'TeamID'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>teams_expanded_5_2 <span class="op">=</span> teams_expanded_5.add_suffix(<span class="st">'_2'</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>teams_expanded_5_2.rename(columns<span class="op">=</span>{<span class="st">'Season_2'</span>: <span class="st">'Season'</span>, <span class="st">'TeamID_2'</span>: <span class="st">'TeamID'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.merge(</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    tourney_results,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    teams_expanded_5_1,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    left_on<span class="op">=</span>[<span class="st">'Season'</span>, <span class="st">'TeamID_1'</span>],</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    right_on<span class="op">=</span>[<span class="st">'Season'</span>, <span class="st">'TeamID'</span>],</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    suffixes<span class="op">=</span>(<span class="st">''</span>, <span class="st">'_1'</span>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.merge(</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    df,</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    teams_expanded_5_2,</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    left_on<span class="op">=</span>[<span class="st">'Season'</span>, <span class="st">'TeamID_2'</span>],</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    right_on<span class="op">=</span>[<span class="st">'Season'</span>, <span class="st">'TeamID'</span>],</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">'left'</span>,</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    suffixes<span class="op">=</span>(<span class="st">''</span>, <span class="st">'_2'</span>)</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Season</th>
<th data-quarto-table-cell-role="th">DayNum</th>
<th data-quarto-table-cell-role="th">TeamID_1</th>
<th data-quarto-table-cell-role="th">Score_1</th>
<th data-quarto-table-cell-role="th">TeamID_2</th>
<th data-quarto-table-cell-role="th">Score_2</th>
<th data-quarto-table-cell-role="th">WLoc</th>
<th data-quarto-table-cell-role="th">NumOT</th>
<th data-quarto-table-cell-role="th">CRType</th>
<th data-quarto-table-cell-role="th">CityID</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">gender_2</th>
<th data-quarto-table-cell-role="th">AvgPointsDiff_2</th>
<th data-quarto-table-cell-role="th">WinRate_2</th>
<th data-quarto-table-cell-role="th">PublicRank_2</th>
<th data-quarto-table-cell-role="th">RankingSystem_2</th>
<th data-quarto-table-cell-role="th">ConfAbbrev_2</th>
<th data-quarto-table-cell-role="th">Description_2</th>
<th data-quarto-table-cell-role="th">Fired_During_Season_2</th>
<th data-quarto-table-cell-role="th">ConsecutiveYears_2</th>
<th data-quarto-table-cell-role="th">ExperienceLevel_2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1985</td>
<td>136</td>
<td>1116</td>
<td>63</td>
<td>1234</td>
<td>54</td>
<td>N</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>M</td>
<td>10.466667</td>
<td>0.666667</td>
<td>NaN</td>
<td>NaN</td>
<td>big_ten</td>
<td>Big Ten Conference</td>
<td>0.0</td>
<td>1.0</td>
<td>NEW</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1985</td>
<td>136</td>
<td>1345</td>
<td>58</td>
<td>1120</td>
<td>59</td>
<td>N</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>M</td>
<td>3.689655</td>
<td>0.620690</td>
<td>NaN</td>
<td>NaN</td>
<td>sec</td>
<td>Southeastern Conference</td>
<td>0.0</td>
<td>1.0</td>
<td>NEW</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1985</td>
<td>136</td>
<td>1250</td>
<td>43</td>
<td>1207</td>
<td>68</td>
<td>N</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>M</td>
<td>15.666667</td>
<td>0.925926</td>
<td>NaN</td>
<td>NaN</td>
<td>big_east</td>
<td>Big East Conference</td>
<td>0.0</td>
<td>1.0</td>
<td>NEW</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1985</td>
<td>136</td>
<td>1229</td>
<td>58</td>
<td>1425</td>
<td>55</td>
<td>N</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>M</td>
<td>3.785714</td>
<td>0.678571</td>
<td>NaN</td>
<td>NaN</td>
<td>pac_ten</td>
<td>Pacific-10 Conference</td>
<td>0.0</td>
<td>1.0</td>
<td>NEW</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1985</td>
<td>136</td>
<td>1325</td>
<td>38</td>
<td>1242</td>
<td>49</td>
<td>N</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>M</td>
<td>5.633333</td>
<td>0.766667</td>
<td>NaN</td>
<td>NaN</td>
<td>big_eight</td>
<td>Big Eight Conference</td>
<td>0.0</td>
<td>1.0</td>
<td>NEW</td>
</tr>
</tbody>
</table>

<p>5 rows × 47 columns</p>
</div>
</div>
</div>
<p>Leave out only the useful columns:</p>
<div id="b7dd8a6c" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df.drop(columns<span class="op">=</span>[</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'TeamID'</span>,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'DayNum'</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'NumOT'</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CRType'</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CityID'</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'gender_2'</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ConfAbbrev_1'</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'WLoc'</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>df.rename(columns<span class="op">=</span>{</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'gender_1'</span>: <span class="st">'gender'</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>}, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Assign the pairwise difference features</p>
<div id="b65272e1" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'seed_diff'</span>] <span class="op">=</span> df[<span class="st">'Seed_num_1'</span>] <span class="op">-</span> df[<span class="st">'Seed_num_2'</span>]</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'rank_diff'</span>] <span class="op">=</span> df[<span class="st">'PublicRank_1'</span>] <span class="op">-</span> df[<span class="st">'PublicRank_2'</span>]</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'win_rate_diff'</span>] <span class="op">=</span> df[<span class="st">'WinRate_1'</span>] <span class="op">-</span> df[<span class="st">'WinRate_2'</span>]</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'points_diff_diff'</span>] <span class="op">=</span> df[<span class="st">'AvgPointsDiff_1'</span>] <span class="op">-</span> df[<span class="st">'AvgPointsDiff_2'</span>]</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'consequtive_years_diff'</span>] <span class="op">=</span> df[<span class="st">'ConsecutiveYears_1'</span>] <span class="op">-</span> df[<span class="st">'ConsecutiveYears_2'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Analyzing seed difference impact on target:</p>
<div id="457bb5fe" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group by seed_diff and calculate the average target</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>grouped_df <span class="op">=</span> df.groupby(by<span class="op">=</span>[<span class="st">'seed_diff'</span>, <span class="st">'gender'</span>])[<span class="st">'target'</span>].mean().reset_index()</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a boxplot for seed_diff vs average target</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>plt.plot(<span class="op">-</span>grouped_df.query(<span class="st">"gender == 'M'"</span>)[<span class="st">'seed_diff'</span>], grouped_df.query(<span class="st">"gender == 'M'"</span>)[<span class="st">'target'</span>], marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'b'</span>, label<span class="op">=</span><span class="st">'Men Avg Seed Diff'</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>plt.plot(<span class="op">-</span>grouped_df.query(<span class="st">"gender == 'W'"</span>)[<span class="st">'seed_diff'</span>], grouped_df.query(<span class="st">"gender == 'W'"</span>)[<span class="st">'target'</span>], marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'r'</span>, label<span class="op">=</span><span class="st">'Women Avg Seed Diff'</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Seed Difference vs Average Target'</span>)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Seed Difference'</span>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average Target'</span>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cs%20670%20report_files/figure-html/cell-24-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Stong dependency of the target base on the seed difference for both men and women can be noticed on the graph. And that makes sens: the higher the seed difference between the 1st team and the 2nd team - the more likely it is that the 1st team outclasses the 2nd one and wins the game.</p>
</section>
</section>
</section>
<section id="model-application" class="level1">
<h1>Model application</h1>
<p>Specifying features and target</p>
<div id="bcfa116d" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> [</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'seed_diff'</span>,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rank_diff'</span>,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'win_rate_diff'</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'points_diff_diff'</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'consequtive_years_diff'</span>,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Seed_num_1'</span>,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Seed_num_2'</span>,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'PublicRank_1'</span>,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'PublicRank_2'</span>,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'WinRate_1'</span>,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'WinRate_2'</span>,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'AvgPointsDiff_1'</span>,</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'AvgPointsDiff_2'</span>,</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ConsecutiveYears_1'</span>,</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ConsecutiveYears_2'</span>,</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'gender'</span>,</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Fired_During_Season_1'</span>,</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Fired_During_Season_2'</span>,</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ExperienceLevel_1'</span>,</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ExperienceLevel_2'</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> <span class="st">'target'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Preparing the data</p>
<div id="a66f4fa9" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df[features]</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[target]</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>X.loc[:, <span class="st">'consequtive_years_diff'</span>] <span class="op">=</span> X[<span class="st">'consequtive_years_diff'</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>X.loc[:, <span class="st">'rank_diff'</span>] <span class="op">=</span> X[<span class="st">'rank_diff'</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>X.loc[:, <span class="st">'PublicRank_1'</span>] <span class="op">=</span> X[<span class="st">'PublicRank_1'</span>].fillna(<span class="dv">15</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>X.loc[:, <span class="st">'PublicRank_2'</span>] <span class="op">=</span> X[<span class="st">'PublicRank_2'</span>].fillna(<span class="dv">15</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>X.loc[:, <span class="st">'Fired_During_Season_1'</span>] <span class="op">=</span> X[<span class="st">'Fired_During_Season_1'</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>X.loc[:, <span class="st">'Fired_During_Season_2'</span>] <span class="op">=</span> X[<span class="st">'Fired_During_Season_2'</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>X.loc[:, <span class="st">'ExperienceLevel_1'</span>] <span class="op">=</span> X[<span class="st">'ExperienceLevel_1'</span>].fillna(<span class="st">'EXPERIENCED'</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>X.loc[:, <span class="st">'ExperienceLevel_2'</span>] <span class="op">=</span> X[<span class="st">'ExperienceLevel_2'</span>].fillna(<span class="st">'EXPERIENCED'</span>)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>X.loc[:, <span class="st">'ConsecutiveYears_1'</span>] <span class="op">=</span> X[<span class="st">'ConsecutiveYears_1'</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>X.loc[:, <span class="st">'ConsecutiveYears_2'</span>] <span class="op">=</span> X[<span class="st">'ConsecutiveYears_2'</span>].fillna(<span class="dv">0</span>)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co"># manual label encoding for Experience level</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>X.loc[:, <span class="st">'ExperienceLevel_1'</span>] <span class="op">=</span> X[<span class="st">'ExperienceLevel_1'</span>].<span class="bu">map</span>({<span class="st">'NEW'</span>: <span class="dv">0</span>, <span class="st">'ENOUGH'</span>: <span class="dv">1</span>, <span class="st">'EXPERIENCED'</span>: <span class="dv">2</span>}).astype(<span class="bu">int</span>)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>X.loc[:, <span class="st">'ExperienceLevel_2'</span>] <span class="op">=</span> X[<span class="st">'ExperienceLevel_2'</span>].<span class="bu">map</span>({<span class="st">'NEW'</span>: <span class="dv">0</span>, <span class="st">'ENOUGH'</span>: <span class="dv">1</span>, <span class="st">'EXPERIENCED'</span>: <span class="dv">2</span>}).astype(<span class="bu">int</span>)</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="co"># one hot encoding for gender</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>X.loc[:, <span class="st">'gender'</span>] <span class="op">=</span> OneHotEncoder(drop<span class="op">=</span><span class="st">'first'</span>).fit_transform(X[[<span class="st">'gender'</span>]]).toarray()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="selected-model-random-forest" class="level2">
<h2 class="anchored" data-anchor-id="selected-model-random-forest"><strong>Selected Model: Random Forest</strong></h2>
<section id="why-random-forest" class="level3">
<h3 class="anchored" data-anchor-id="why-random-forest">Why Random Forest?</h3>
<ul>
<li><strong>Hyperparameter Flexibility:</strong>
<ul>
<li>Easy to tune to prevent overfitting, especially given a small dataset (~4500 samples).</li>
</ul></li>
<li><strong>Captures Complex Dependencies:</strong>
<ul>
<li>Can handle non-linear relationships and interactions between features.</li>
</ul></li>
<li><strong>Feature Importance Estimation:</strong>
<ul>
<li>Helps identify the most influential variables in predicting game outcomes.</li>
</ul></li>
</ul>
</section>
</section>
<section id="optimized-hyperparameters-after-grid-search-cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="optimized-hyperparameters-after-grid-search-cross-validation">Optimized Hyperparameters (After Grid Search &amp; Cross-Validation)</h2>
<section id="the-best-parameters-were-selected-using-grid-search-with-time-series-cross-validation-optimizing-model-performance-while-preventing-overfitting" class="level3">
<h3 class="anchored" data-anchor-id="the-best-parameters-were-selected-using-grid-search-with-time-series-cross-validation-optimizing-model-performance-while-preventing-overfitting">The best parameters were selected using grid search with time series cross-validation, optimizing model performance while preventing overfitting:</h3>
<p>- <strong>n_estimators = 1000</strong> (Number of trees in the forest)</p>
<p>- <strong>min_samples_split = 5</strong> (Minimum samples required to split an internal node) - <strong>min_samples_leaf = 15</strong> (Minimum samples required to be a leaf node)</p>
<p>- <strong>max_features = 0.3</strong> (Fraction of total features considered per split)</p>
<p>- <strong>max_depth = 5</strong> (Maximum depth of trees to control complexity)</p>
<p>These settings ensure the model remains <strong>robust, generalizable, and interpretable</strong>, making it well-suited for predicting March Madness game outcomes.</p>
<p>Code for grid search implementation:</p>
<div id="d461f6ba" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gen_time_iterator(n_splits<span class="op">=</span><span class="dv">8</span>):</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    tscv <span class="op">=</span> TimeSeriesSplit(n_splits<span class="op">=</span>n_splits)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    seasons <span class="op">=</span> pd.Series(<span class="bu">range</span>(<span class="dv">1985</span>, <span class="dv">2025</span>))</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    myTimeiterator <span class="op">=</span> []</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> train_index, test_index <span class="kw">in</span> tscv.split(seasons):</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        train_seasons <span class="op">=</span> seasons[train_index]</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>        test_seasons <span class="op">=</span> seasons[test_index]</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>        train_indices <span class="op">=</span> df[df[<span class="st">'Season'</span>].isin(train_seasons)].index</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>        test_indices <span class="op">=</span> df[df[<span class="st">'Season'</span>].isin(test_seasons)].index</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>        myTimeiterator.append((train_indices, test_indices))</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> myTimeiterator</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="co"># param_grid = {</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     'n_estimators': [300, 500, 1000],            # Number of trees</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     'max_depth': [5, 7, 10, None],                 # Limit tree depth</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="co">#     'min_samples_split': [2, 5, 10, 20],              # Require more samples for splitting</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="co">#     'min_samples_leaf': [2, 4, 10, 15],                # More samples per leaf to generalize</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a><span class="co">#     'max_features': ['sqrt', 'log2', 0.3, 0.5, 0.8],  # Reduce correlation among trees</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="co"># grid_search = RandomizedSearchCV(</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a><span class="co">#     n_iter=400,</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a><span class="co">#     estimator=RandomForestClassifier(random_state=42),</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a><span class="co">#     param_distributions=param_grid,</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a><span class="co">#     scoring='neg_brier_score',</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a><span class="co">#     cv=gen_time_iterator(n_splits=5),</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a><span class="co">#     n_jobs=-1,</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a><span class="co">#     verbose=3</span></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a><span class="co"># grid_search.fit(X, y)</span></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a><span class="co"># # Best parameters after search:</span></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Best parameters found:", grid_search.best_params_)</span></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a><span class="co"># print("Best cross-validation accuracy:", grid_search.best_score_)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Defining the final model:<br>
</p>
<div id="d0a4abb1" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>final_model <span class="op">=</span> RandomForestClassifier(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    n_estimators<span class="op">=</span><span class="dv">1000</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    min_samples_split<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    min_samples_leaf<span class="op">=</span><span class="dv">15</span>,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    max_features<span class="op">=</span><span class="fl">0.3</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    max_depth<span class="op">=</span><span class="dv">5</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>final_model.fit(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<style>#sk-container-id-2 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-2 {
  color: var(--sklearn-color-text);
}

#sk-container-id-2 pre {
  padding: 0;
}

#sk-container-id-2 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-2 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-2 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-2 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-2 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-2 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-2 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-2 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-2 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-2 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-2 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-2 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-2 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-2 div.sk-label label.sk-toggleable__label,
#sk-container-id-2 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-2 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-2 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-2 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-2 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-2 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-2 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-2 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-2 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-2 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestClassifier(max_depth=5, max_features=0.3, min_samples_leaf=15,
                       min_samples_split=5, n_estimators=1000, random_state=42)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked=""><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>RandomForestClassifier</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.ensemble.RandomForestClassifier.html">?<span>Documentation for RandomForestClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted"><pre>RandomForestClassifier(max_depth=5, max_features=0.3, min_samples_leaf=15,
                       min_samples_split=5, n_estimators=1000, random_state=42)</pre></div> </div></div></div></div>
</div>
</div>
<p>Feature importances:</p>
<div id="636506db" class="cell" data-execution_count="28">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>importances <span class="op">=</span> final_model.feature_importances_</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>indices <span class="op">=</span> np.argsort(importances)[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Feature Importances"</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>sns.barplot(x<span class="op">=</span>importances[indices], y<span class="op">=</span>[features[i] <span class="cf">for</span> i <span class="kw">in</span> indices], palette<span class="op">=</span><span class="st">'viridis'</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Importance'</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Feature'</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/8v/bx_f_4bj0klchryrhdgxty9h0000gn/T/ipykernel_86666/1364103695.py:6: FutureWarning: 

Passing `palette` without assigning `hue` is deprecated and will be removed in v0.14.0. Assign the `y` variable to `hue` and set `legend=False` for the same effect.

  sns.barplot(x=importances[indices], y=[features[i] for i in indices], palette='viridis')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cs%20670%20report_files/figure-html/cell-29-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Insights:</p>
<ul>
<li><p>Seed difference turned out to be the most impactful as expected</p></li>
<li><p>Gender feature didn’t turn out to impactfull. This may imply that the target behaviour between men and women is very similar.</p></li>
<li><p>Coach features didn’t turn out to be significantly important. All the coach dependencies could already be implicitly encoded in other features such as Seed Diff, Win Rate diff since the coach can have a impact on those.</p></li>
</ul>
</section>
</section>
<section id="evaluation" class="level2">
<h2 class="anchored" data-anchor-id="evaluation">Evaluation</h2>
<p>Lets see how our model behaves throughout the years: predicting each year based on all the previous years data.</p>
<p>Implementation:</p>
<div id="2c04df42" class="cell" data-execution_count="29">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> estimate_year_score(year):</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    train_indices <span class="op">=</span> df[(<span class="dv">1985</span> <span class="op">&lt;=</span> df[<span class="st">'Season'</span>]) <span class="op">&amp;</span> (df[<span class="st">'Season'</span>] <span class="op">&lt;=</span> year<span class="op">-</span><span class="dv">1</span>)].index</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    test_indices <span class="op">=</span> df[df[<span class="st">'Season'</span>] <span class="op">==</span> year].index</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    X_train <span class="op">=</span> X.iloc[train_indices]</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y.iloc[train_indices]</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    X_test <span class="op">=</span> X.iloc[test_indices]</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    y_test <span class="op">=</span> y.iloc[test_indices]</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    final_model <span class="op">=</span> RandomForestClassifier(</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>        random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>        n_estimators<span class="op">=</span><span class="dv">1000</span>,</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>        min_samples_split<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>        min_samples_leaf<span class="op">=</span><span class="dv">15</span>,</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>        max_features<span class="op">=</span><span class="fl">0.3</span>,</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>        max_depth<span class="op">=</span><span class="dv">5</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    final_model.fit(X_train, y_train)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> final_model.predict_proba(X_test)[:, <span class="dv">1</span>]</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    brier_score <span class="op">=</span> brier_score_loss(y_test, y_pred)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    accuracy <span class="op">=</span> accuracy_score(y_test, y_pred <span class="op">&gt;</span> <span class="fl">0.5</span>)</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">float</span>(brier_score), accuracy</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>years <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1986</span>, <span class="dv">2020</span>)) <span class="op">+</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">2021</span>, <span class="dv">2025</span>))</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>brier_scores <span class="op">=</span> []</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>accuracies <span class="op">=</span> []</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> years:</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> year <span class="op">==</span> <span class="dv">2020</span>:</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>    brier_score, accuracy <span class="op">=</span> estimate_year_score(year)</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>    brier_scores.append(brier_score)</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>    accuracies.append(accuracy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Plot the accuracy and brier score:</p>
<div id="d99cdf50" class="cell" data-execution_count="30">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Brier scores</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>plt.plot(years, brier_scores, marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'b'</span>, label<span class="op">=</span><span class="st">'Brier Score'</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>plt.axhline(y<span class="op">=</span>np.mean(brier_scores), color<span class="op">=</span><span class="st">'r'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="ss">f'Average Brier Score = </span><span class="sc">{</span>np<span class="sc">.</span>mean(brier_scores)<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>plt.axhline(y<span class="op">=</span><span class="fl">0.1737</span>, color<span class="op">=</span><span class="st">'g'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="st">'2023 Winning Score = 0.173'</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Brier Score by Year'</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Year'</span>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Brier Score'</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot accuracies</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>plt.plot(years, accuracies, marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, color<span class="op">=</span><span class="st">'b'</span>, label<span class="op">=</span><span class="st">'Accuracy'</span>)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>plt.axhline(y<span class="op">=</span>np.mean(accuracies), color<span class="op">=</span><span class="st">'r'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="ss">f'Average Accuracy = </span><span class="sc">{</span>np<span class="sc">.</span>mean(accuracies)<span class="sc">:.2f}</span><span class="ss">'</span>)</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Accuracy by Year'</span>)</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Year'</span>)</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Accuracy'</span>)</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cs%20670%20report_files/figure-html/cell-31-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cs%20670%20report_files/figure-html/cell-31-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can see that the target score is very noisy. This can be explained by 2 factors:</p>
<ul>
<li><p>The dataset for each year consists of ~150 games (march madness games for men and women) which is very small.</p></li>
<li><p>The nature of the game has a certain degree of randomness which is almost impossible to predict based on the data available (ex. key player got an injury in training which negatively impacted the team performance.<br>
</p></li>
</ul>
<p>Still, we achive a performance, comparable to the top kaggle solutions for prevous years.</p>
<p>Predictions for UO:</p>
<p><img src="images/pred.png" class="img-fluid"></p>
<p>We can also look at the predictions for this season’s UO Men’s.</p>
<p>This graph actually shows that the model doesn’t solely base the predictions on the seed difference.</p>
<p>For example such teams as St Mary’s CA and BYU which are seeded lower that Oregon still have a higher chance of winning against Oregon :((.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>The research successfully applied data-driven methods to predict March Madness game outcomes, yielding valuable insights and competitive performance.</p>
</section>
<section id="key-takeaways" class="level2">
<h2 class="anchored" data-anchor-id="key-takeaways"><strong>Key Takeaways</strong></h2>
<ul>
<li><strong>Identified the Most Important Predictive Features</strong>
<ul>
<li>The analysis pinpointed key factors influencing game outcomes, helping refine predictive models.</li>
</ul></li>
<li><strong>Achieved Competitive Performance</strong>
<ul>
<li>The model’s accuracy was comparable to <strong>top-performing solutions from previous years</strong>, validating its effectiveness.</li>
</ul></li>
<li><strong>Potential Applications</strong>
<ul>
<li>The findings have practical implications for <strong>sports analytics</strong>, enabling better data-driven strategies for teams and analysts.</li>
<li>The model can be leveraged in the <strong>betting industry</strong>, where accurate predictions enhance decision-making for sportsbooks and bettors.</li>
</ul></li>
</ul>
<p>Overall, this report demonstrates the power of <strong>machine learning in sports analytics</strong>, contributing to more precise and insightful March Madness predictions.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>